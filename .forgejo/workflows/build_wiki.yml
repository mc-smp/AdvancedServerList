name: Build Wiki

on:
  push:
    branches:
      - master
    paths:
      - '.forgejo/workflows/build_wiki.yml'
      - 'docs/**'
      - 'domains'
      - 'mkdocs.yml'
      - 'requirements.txt'
  workflow_dispatch:

jobs:
  buildWiki:
    runs-on: codeberg-tiny
    container:
      image: ghcr.io/catthehacker/ubuntu:act-latest
    steps:
      - name: "Checkout Source Repository"
        uses: https://code.forgejo.org/actions/checkout@v4
        with:
          token: "${{ secrets.BOT_TOKEN }}"
          fetch-depth: 0 # Prevents issues with git-revision-date-localized plugin
      - name: "Checkout Target Repository"
        run: |
          git clone -b pages https://codeberg.org/Andre601/asl-docs.git site
      - name: "Setup Python 3.x"
        uses: https://code.forgejo.org/actions/setup-python@v5
        with:
          python-version: 3.x
      - name: "Install dependencies"
        run: "pip install -r requirements.txt"
      - name: "Build docs"
        run: "mkdocs build"
      - name: "Commit and Push"
        run: |
          mv domains site/.domains
          cd site
          git remote set-url origin https://${{ secrets.BOT_TOKEN }}@codeberg.org/Andre601/asl-docs.git
          git add --all
          git commit -m "Update AdvancedServerList Wiki ($( env TZ=Europe/Zurich date +"%d.%m.%Y %Z" ))"
          git push